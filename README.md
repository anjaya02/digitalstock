# DigitalStock â€“ Mobile POS for Sriâ€‘Lankan Corner Shops

A lightweight, bilingual (EN/à·ƒà·’à¶‚) Flutter application that turns any Android phone into an offlineâ€‘first pointâ€‘ofâ€‘sale system.  Core focus: realâ€‘time & dayâ€‘end sales entry, automatic stock deduction, receipt/PDF export, and Supabaseâ€‘backed cloud sync â€” with perâ€‘user data isolation.

---

## âœ¨ Features

| Tier                                | Free                          | Premium   |
| ----------------------------------- | ----------------------------- | --------- |
| Items & turnover                    | â‰¤â€¯1â€¯000 items / Rsâ€¯100â€¯000Â mo | Unlimited |
| Realâ€‘time & Endâ€‘ofâ€‘day modes        | âœ…                             | âœ…         |
| Cash / QR / Card tracking           | âœ…                             | âœ…         |
| Offlineâ€‘first + background sync     | âœ…                             | âœ…         |
| Automatic stock deduction           | âœ…                             | âœ…         |
| Daily / Weekly PDF                  | âœ…                             | âœ…         |
| Lowâ€‘stock alerts                    | âœ–ï¸                            | âœ…         |
| Pieâ€‘chart dashboard / custom ranges | âœ–ï¸                            | âœ…         |
| WhatsApp receipt sharing            | âœ–ï¸                            | âœ…         |
| Staff logâ€‘ins                       | âœ–ï¸                            | âœ…         |
| SMS endâ€‘ofâ€‘day summaries            | âœ–ï¸                            | âœ…         |

---

## ğŸ— Tech Stack

| Layer         | Choice                    | Notes                                         |
| ------------- | ------------------------- | --------------------------------------------- |
| UI            | **FlutterÂ 3**             | MaterialÂ 3, Poppins font, Provider state mgmt |
| Local storage | SQLite via `sqflite`      | Offline queue & cache                         |
| Cloud         | **Supabase** (PostgreSQL) | Auth, RLS, realtime, storage                  |
| PDF/Print     | `pdf`, `printing` pkgs    | Bluetooth printers via SDK placeholder        |
| Icons         | `flutter_launcher_icons`  | Uses `assets/images/logoâ€‘icon.png`            |

Project structure (partial):

```
lib/
  models/      domain classes (Item, Sale, ...)
  providers/   ItemProvider, SaleProvider, ReportsProvider, ...
  screens/     auth/, sales/, reports/, â€¦
  ui/          design_system.dart (theme + widgets)
assets/
  images/logo-icon.png
  config/.env            â† Supabase keys
```

---

## ğŸ”§ Prerequisites

1. **FlutterÂ 3.22+** with Android toolâ€‘chain.
2. A Supabase project *(Free tier is fine)*.
3. Copy `.env.sample` â†’ `assets/config/.env` and fill:

```
SUPABASE_URL=https://<YOURâ€‘REF>.supabase.co
SUPABASE_ANON_KEY=<public_anon_key>
```

4. Enable **Email** provider in Supabase Auth.  Disable email confirmations only if kiosk build.
5. Run the SQL in [`database/schema.sql`](#database-setup) to create tables & RLS.

---

## ğŸ—„ Database Setup

```sql
-- sales parent
create table public.sales (
  id          uuid primary key,
  user_id     uuid references auth.users(id) on delete cascade,
  timestamp   timestamptz not null default now(),
  payment_method text not null,
  total       numeric not null
);

-- item lines
create table public.sale_items (
  id          bigint generated by default as identity primary key,
  sale_id     uuid references public.sales(id) on delete cascade,
  item_id     text,
  item_name   text,
  qty         int  not null,
  price_each  numeric not null
);

-- user profiles for display name
create table public.profiles (
  id            uuid primary key,
  display_name  text
);

-- Rowâ€‘level security
alter table sales       enable row level security;
alter table sale_items  enable row level security;
alter table profiles    enable row level security;

create policy "Sales are private" on sales
  for all using (user_id = auth.uid()) with check (user_id = auth.uid());

create policy "Lines inherit parent" on sale_items
  for all using (sale_id in (select id from sales where user_id = auth.uid()));

create policy "Users can read/update own profile" on profiles
  for all using (id = auth.uid()) with check (id = auth.uid());
```

---

## ğŸš€ Running Locally

```bash
flutter pub get
flutter pub run flutter_launcher_icons:main   # oneâ€‘time
flutter run                                    # debug
```

> **Release APK**
>
> ```bash
> flutter build apk --release
> ```
>
> Ensure `android:label="DigitalStock"` and `<uses-permission android:name="android.permission.INTERNET"/>` in *AndroidManifest.xml*.

---

## ğŸ“ Key Implementation Notes

* `SaleProvider.fetchRemote()` downloads *all* sales for current user **after login**.
* `ReportsProvider` listens to `SaleProvider` â†’ reports & PDFs always include fetched history.
* Launcher icon generated from `assets/images/logo-icon.png` via *flutter\_launcher\_icons*.
* First login autoâ€‘creates blank row in `profiles` table (`maybeSingle + insert`).
* RLS ensures each Supabase query is already scoped by `auth.uid()`.

---

## ğŸ¯ Roadmap / TODO

* [ ] Lowâ€‘stock push notifications
* [ ] Multiâ€‘branch syncing
* [ ] Supplier marketplace plugâ€‘in
* [ ] PayHere / WebXPay subscription billing
* [ ] Bluetooth printer integration

---

## ğŸ¤ Contributing

1. Fork & pullâ€‘request from a feature branch.
2. Follow DartÂ `dart format`Â /Â `flutter analyze` clean lint.
3. Explain the problem & solution clearly in the PR.

MITÂ Â©Â 2025Â DigitalStock Team
